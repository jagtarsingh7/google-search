<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>not-google ‚ù§Ô∏è</title>
  <style>
    :root { --blue:#1a73e8; --shadow:0 8px 28px rgba(0,0,0,.15); }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:grid; place-items:center; background:#fff; color:#202124;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    }
    .wrap{width:min(720px,92vw); text-align:center;}
    .logo{font-size:clamp(42px,8vw,86px); font-weight:800; letter-spacing:.5px; user-select:none}
    .logo span:nth-child(1){color:#4285F4}
    .logo span:nth-child(2){color:#DB4437}
    .logo span:nth-child(3){color:#F4B400}
    .logo span:nth-child(4){color:#4285F4}
    .logo span:nth-child(5){color:#0F9D58}
    .logo span:nth-child(6){color:#DB4437}

    .search{
      margin:22px auto 0; display:flex; align-items:center; gap:10px; padding:12px 16px;
      border:1px solid #dadce0; border-radius:999px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.06);
      transition:box-shadow .15s ease, transform .15s ease;
    }
    .search:focus-within{ box-shadow:0 10px 24px rgba(0,0,0,.12); transform:translateY(-1px); }
    .search input{flex:1; border:0; outline:none; font-size:16px; padding:6px 4px}
    .btns{display:flex; justify-content:center; gap:10px; margin-top:24px; flex-wrap:wrap}
    button{
      border:1px solid #f1f3f4; background:#f8f9fa; padding:10px 18px; border-radius:8px; cursor:pointer; font-size:14px;
      transition:transform .02s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{background:#f1f3f4; border-color:#dadce0}
    button:active{transform:translateY(1px)}
    .hint{margin-top:10px; font-size:12px; color:#5f6368}

    /* Modal */
    dialog{
      border:none; padding:0; border-radius:16px; box-shadow:var(--shadow); width:min(560px,92vw); overflow:hidden;
      animation:pop .18s ease-out;
    }
    @keyframes pop{from{transform:scale(.96); opacity:.0} to{transform:scale(1); opacity:1}}
    .modal{padding:28px 26px}
    .modal h1{margin:0 0 6px; font-size:clamp(24px,4.5vw,34px)}
    .modal p{margin:8px 0 0; color:#5f6368}
    .rec-box{
      margin-top:16px; padding:14px; border:1px dashed #e0e3e7; border-radius:12px; background:#fbfcff;
    }
    .rec{font-size:18px}
    .actions{margin-top:16px; display:flex; gap:8px; justify-content:center}
    .ok{background:var(--blue); color:#fff; border-color:var(--blue)}
    .ghost{background:#fff}
    .heart{display:inline-block; margin-left:6px; animation:beat 1.2s infinite}
    @keyframes beat{0%,100%{transform:scale(1)} 50%{transform:scale(1.12)}}
    .footer-note{font-size:12px; color:#9aa0a6; margin-top:14px}

    /* Tiny confetti */
    .confetti{position:fixed; inset:0; pointer-events:none}
    .confetti i{position:absolute; width:8px; height:14px; opacity:0; transform:translateY(-20px) rotate(0deg)}
  </style>
</head>
<body>
  <main class="wrap">
    <div class="logo" aria-label="Logo">
      <span>G</span><span>o</span><span>o</span><span>g</span><span>l</span><span>e</span>
    </div>

    <form id="searchForm" autocomplete="off" role="search" aria-label="Search demo">
      <div class="search">
        <input id="q" type="text" placeholder="Search..." aria-label="Search input"/>
      </div>
      <div class="btns">
        <button type="submit">Google Search</button>
        <button type="button" id="lucky">I'm Feeling Lucky</button>
      </div>
      <div class="hint">Type anything. I‚Äôll echo it and give a playful recommendation üíò</div>
      <div class="hint" id="statusLine" aria-live="polite"></div>
      <div style="margin-top:8px">
        <button type="button" id="testWrite" style="font-size:12px;border:1px solid #e5e7eb;padding:6px 10px;border-radius:6px;background:#fff;cursor:pointer">Run Firestore test write</button>
      </div>
    </form>
  </main>

  <dialog id="resultDialog">
    <div class="modal">
      <h1 id="headline">Here‚Äôs my take <span class="heart">üíô</span></h1>
      <p id="youSearched"></p>
      <div class="rec-box">
        <div class="rec" id="recommendation"></div>
      </div>
      <div class="actions">
        <button class="ok" id="closeModal">OK</button>
        <button class="ghost" id="openNewPage">Open as new page</button>
      </div>
      <div class="footer-note">Tip: try words like ‚Äúyes‚Äù, ‚Äúlove‚Äù, ‚Äúmarry‚Äù üòâ</div>
    </div>
  </dialog>
  <div class="confetti" id="confetti"></div>

  <!-- Firebase: log each search to Firestore -->
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBmR-D0xa8c_wh2vS7uPw1FwL_7-fN8Xjo",
    authDomain: "hope-6fe19.firebaseapp.com",
    projectId: "hope-6fe19",
    storageBucket: "hope-6fe19.firebasestorage.app",
    messagingSenderId: "605032966039",
    appId: "1:605032966039:web:122b19f529e5db9ee7c6d2",
    measurementId: "G-S8G7B4EY5T"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // Anonymous authentication with clear logging
  signInAnonymously(auth)
    .then(() => console.log('‚úÖ Firebase: Signed in anonymously.'))
    .catch(error => console.error('‚ùå Firebase Auth Error:', error));

  // Log user info when ready
  onAuthStateChanged(auth, (user) => {
    if (user) console.log('üë§ Firebase user UID:', user.uid);
  });

  console.log('Firebase init complete for project:', firebaseConfig.projectId, 'authDomain:', firebaseConfig.authDomain);

  // Firestore write with better logs
  window.logSearchToFirestore = async function(text) {
    const clean = (text || '').toString().slice(0, 300);
    if (!clean) return;

    try {
      const ref = await addDoc(collection(db, 'searches'), {
        text: clean,
        ua: navigator.userAgent || '',
        ts: serverTimestamp()
      });
      console.log('‚úÖ Firestore: Logged search:', clean, '‚Üí doc ID:', ref.id);
    } catch (e) {
      console.error('‚ùå Firestore write failed:', e);
    }
  };
</script>

<script>
  window.addEventListener('error', e => console.error('Window error:', e.message));
  window.addEventListener('unhandledrejection', e => console.error('Unhandled promise rejection:', e.reason));
</script>

  <script>
    // --- Funny rotating recommendations (no repeat until all used) ---
    const BASE_RECS = [
      "Yes‚Äîyou should. Like, absolutely. ‚úÖ",
      "Do it. He‚Äôs a good guy. The best, actually. üòå",
      "A gentle nudge: say yes. Your future self says thanks. üíå",
      "Green flag detected. Proceed with maximum cuteness. üü¢",
      "Consider this an official approval stamp: YES. ‚úçÔ∏è",
      "Plot twist: you already knew the answer. It‚Äôs yes. üòâ",
      "Zero doubts. 100% yes. Science agrees. üî¨‚ú®",
      "Breaking news: Hearts vote YES by unanimous decision. üó≥Ô∏è‚ù§Ô∏è",
      "Yes, you should‚Äîhurry before you miss the train of destiny. üöÜ",
      "Statistically speaking, yes increases happiness by 1000%. üìà"
    ];
    const SPECIAL_RECS = [
      "She said yes (manifesting). Cue confetti! üéâ",
      "Ring the bells‚ÄîYES energy detected! üîîüíç",
      "Certified YES moment. Screenshot this. üßæ"
    ];
    let recPool = shuffle([...BASE_RECS]);

    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }
    function nextRec(q=""){
      const t = (q||"").toLowerCase();
      // Easter eggs
      if (/(^|\b)(yes|marry|love|proposal|accept)\b/.test(t)) {
        return SPECIAL_RECS[Math.floor(Math.random()*SPECIAL_RECS.length)];
      }
      if (recPool.length===0) recPool = shuffle([...BASE_RECS]);
      return recPool.pop();
    }

    // Tiny confetti without libs
    function confettiBurst(){
      const box = document.getElementById('confetti');
      if(!box) return;
      for(let i=0;i<36;i++){
        const p = document.createElement('i');
        const x = Math.random()*100;
        const dur = 800 + Math.random()*900;
        const rot = Math.random()*360;
        p.style.left = x + 'vw';
        p.style.top = '-10px';
        p.style.opacity = '1';
        p.style.background = ['#4285F4','#DB4437','#F4B400','#0F9D58'][i%4];
        p.animate([
          { transform:`translateY(-20px) rotate(${rot}deg)`, opacity:1 },
          { transform:`translateY(120vh) rotate(${rot+220}deg)`, opacity:0.7 }
        ], { duration: dur, easing: 'cubic-bezier(.2,.7,.2,1)'});
        box.appendChild(p);
        setTimeout(()=>box.removeChild(p), dur+50);
      }
    }

    // Existing elements
    const form = document.getElementById('searchForm');
    const input = document.getElementById('q');
    const dialog = document.getElementById('resultDialog');
    const youSearched = document.getElementById('youSearched');
    const recommendation = document.getElementById('recommendation');
    const closeModal = document.getElementById('closeModal');
    const openNewPageBtn = document.getElementById('openNewPage');
    const statusLine = document.getElementById('statusLine');
    const testWriteBtn = document.getElementById('testWrite');

    function showResult(q){
      const text = (q||'').trim();
      if(!text) { input.focus(); return; }

      // Firestore logging (non-blocking)
      if (window.logSearchToFirestore) {
        window.logSearchToFirestore(text)
          .then(() => status('Saved to Firestore'))
          .catch(err => status('Firestore error: ' + (err && err.message || 'see console')));
      } else {
        status('Firestore not ready (window.logSearchToFirestore missing)');
      }

      // Fill modal
      youSearched.textContent = `You searched: ‚Äú${text}‚Äù`;
      recommendation.textContent = `My recommendation: ${nextRec(text)}`;

      try {
        if (dialog && typeof dialog.showModal === 'function') {
          dialog.showModal();
          confettiBurst();
          status('Modal opened');
        } else {
          throw new Error('dialog.showModal not available');
        }
      } catch (err) {
        console.warn('dialog.showModal failed, using fallback page:', err);
        status('Opening fallback page');
        openNewPage(text);
      }
    }

    function openNewPage(q){
      const win = window.open('', '_blank');
      if (!win) return alert('Pop-up blocked. Allow pop-ups for this site.');
      const safeQ = (q||'').replace(/[&<>]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]));
      const msg = nextRec(q);
      const html = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Result</title>
  <style>
    body{margin:0;min-height:100vh;display:grid;place-items:center;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;background:#fff;color:#202124}
    .box{text-align:center;padding:28px}
    h1{font-size:clamp(28px,6vw,46px);margin:0 0 10px}
    p{color:#5f6368;margin:4px 0}
    .rec{margin-top:10px;font-size:18px}
  </style>
</head>
<body>
  <div class="box">
    <h1>Here‚Äôs my take üíô</h1>
    <p>You searched: ‚Äú${safeQ}‚Äù</p>
    <p class="rec">My recommendation: ${msg}</p>
  </div>
</body>
</html>`;
      win.document.open();
      win.document.write(html);
      win.document.close();
    }

    function status(msg){ if(statusLine) statusLine.textContent = msg; console.log('[status]', msg); }

    if (testWriteBtn) {
      testWriteBtn.addEventListener('click', async () => {
        try {
          if (window.logSearchToFirestore) {
            await window.logSearchToFirestore('diagnostic test');
            status('Diagnostic write OK');
          } else {
            status('Diagnostic: Firestore logger not available');
          }
        } catch (e) {
          status('Diagnostic write failed');
          console.error('Diagnostic write failed:', e);
        }
      });
    }

    form.addEventListener('submit', e => { e.preventDefault(); showResult(input.value); });
    document.getElementById('lucky').addEventListener('click', () => showResult(input.value || 'Feeling lucky'));
    closeModal.addEventListener('click', () => dialog.close());
    openNewPageBtn.addEventListener('click', () => { dialog.close(); openNewPage(input.value); });
    dialog.addEventListener('close', () => { input.focus(); });
  </script>
</body>
</html>